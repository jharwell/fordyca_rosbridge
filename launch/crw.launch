<?xml version="1.0" ?>

<rosrobot-configuration>

  <launch>
    <!-- Core bringup -->
    <include file="$(find turtlebot3_bringup)/launch/turtlebot3_core.launch"/>

    <!-- Enable LIDAR for collision avoidance -->
    <include file="$(find turtlebot3_bringup)/launch/turtlebot3_lidar.launch"/>

    <!-- Add diagnostics -->
    <node pkg="turtlebot3_bringup" type="turtlebot3_diagnostics" name="turtlebot3_diagnostics" output="screen"/>
  </launch>

  <params>
    <!-- ****************** -->
    <!-- * Controller     * -->
    <!-- ****************** -->
    <controller>
      <output
          output_parent="output"
          output_leaf="__current_date__"
          />
      <strategy>
        <explore
            block_strategy="CRW"/>
        <nest_acq
            strategy="random_thresh"
            />
      </strategy>
      <sensing_subsystemQ3D>
        <!-- -5pi/6 : 5pi/6 -->
        <proximity_sensor fov="-2.61:2.61"
                          delta="0.1" />

        <ground_sensor>
          <!-- NEST: The nest is a relatively light gray. -->
          <nest range="0.6:0.8"
                consensus="3"/>
          <!-- BLOCK: Blocks are black. -->
          <block range="-0.05:0.05"
                 consensus="4"/>
        </ground_sensor>
      </sensing_subsystemQ3D>
      <actuation_subsystem2D>
        <force_calculator>
          <avoidance_force lookahead="0.5"
                           max="0.08"/>
          <wander_force circle_distance="4.0"
                        circle_radius="100.0"
                        max="0.09"
                        interval="1">
            <!-- 5 degrees max delta. -->
            <bias_angle src="uniform"
                        max_delta="0.0872"/>
          </wander_force>
          <phototaxis_force max="0.08"/>
        </force_calculator>

        <!-- 25 degrees soft_turn_max. -->
        <diff_drive soft_turn_max="0.436"
                    max_speed="0.1" />
      </actuation_subsystem2D>
    </controller>

    <!-- ****************** -->
    <!-- * Loop functions * -->
    <!-- ****************** -->
    <loop_functions>
      <output output_parent="output"
              output_leaf="__current_date__">
        <metrics
            metrics_path="metrics">
          <sinks>
            <csv>
              <append
                  output_interval="1000"
                  block_transporter="block-transporter.csv"
                  block_transportee="block-transportee.csv"
                  spatial_interference_counts="spatial-interference-counts.csv"
                  spatial_movement="spatial-movement.csv"
                  spatial_nest_zone='spatial-nest-zone'
                  block_acq_counts="block-acq-counts.csv"
                  block_manipulation="block-manipulation.csv"
                  />
              <create
                  output_interval="10"
                  spatial_interference_locs2D="spatial-interference-locs.csv"
                  block_acq_locs2D="block-acq-locs.csv"
                  block_acq_explore_locs2D="block-acq-explore-locs.csv"
                  block_acq_vector_locs2D="block-acq-vector-locs.csv"
                  spatial_dist_pos2D="spatial-dist-pos2D.csv"/>
            </csv>
          </sinks>
        </metrics>
      </output>
    </loop_functions>
  </params>
</rosrobot-configuration>
